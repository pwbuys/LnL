import{a as U}from"./chunk-QDXSJC2J.js";import"./chunk-PDHAO4X2.js";import{a as L,b as G,c as B,d as z,e as R,f as Q,g as q,h as K,i as j,j as H,k as J}from"./chunk-WHULS3JR.js";import"./chunk-WDXSJPWS.js";import{$ as x,D as M,E as w,F as b,G as W,I,J as F,K as v,L as s,M as a,N as O,R as C,S as f,U as p,V as N,W as P,X as V,_ as c,aa as T,j as h,ja as $,k as g,l as _,la as D,o as y,v as l,y as k}from"./chunk-FYXY47SE.js";import{a as E,b as A}from"./chunk-2NFLSA4Y.js";var Y=["wordInput"];function Z(d,e){d&1&&(s(0,"span",8),c(1,"Set name is required"),a())}function tt(d,e){if(d&1&&(s(0,"span",13),c(1),a()),d&2){let t=p().$index,r=p();l(),x(r.wordEntries()[t].error)}}function et(d,e){if(d&1){let t=C();s(0,"button",19),f("click",function(){g(t);let o=p().$index,n=p();return _(n.removeWord(o))}),c(1," \u2715 "),a()}}function rt(d,e){if(d&1){let t=C();s(0,"div",12)(1,"input",17,0),f("blur",function(){let o=g(t).$index,n=p();return _(n.onWordBlur(o))})("input",function(){let o=g(t).$index,n=p();return _(n.clearError(o))})("keydown",function(o){let n=g(t).$index,u=p();return _(u.onWordInputKeydown(o,n))}),a(),w(3,tt,2,1,"span",13),w(4,et,2,0,"button",18),a()}if(d&2){let t,r=e.$index,o=e.$index,n=p();v("formGroupName",o),l(),v("placeholder","e.g., "+(r===0?"die":"en")),M("data-word-index",o),l(2),b((t=n.wordEntries()[o])!=null&&t.error?3:-1),l(),b(n.wordsArray.length>1?4:-1)}}function nt(d,e){d&1&&(s(0,"span",13),c(1,"At least one valid word is required"),a())}var X=class d{fb=h(H);sightWordStateService=h(U);router=h(D);route=h($);form;wordEntries=y([]);isEditMode=y(!1);editingSetId=null;wordInputs;constructor(){this.form=this.fb.group({setName:["",[G.required]],words:this.fb.array([this.createWordControl()],[this.atLeastOneValidWord])}),this.route.params.subscribe(e=>{let t=e.setId;t?(this.isEditMode.set(!0),this.editingSetId=t,this.loadSetForEditing(t)):(this.isEditMode.set(!1),this.editingSetId=null,this.updateWordEntries())})}ngAfterViewInit(){this.focusInput(0)}loadSetForEditing(e){let t=this.sightWordStateService.getSetById(e);if(!t){this.router.navigate(["/afrikaans/sigwoorde"]);return}for(this.form.patchValue({setName:t.name});this.wordsArray.length>0;)this.wordsArray.removeAt(0);t.cards.forEach(u=>{let i=this.createWordControl();i.patchValue({input:u.word}),this.wordsArray.push(i)}),this.wordsArray.controls.forEach((u,i)=>{this.validateWord(i)}),(this.wordsArray.at(this.wordsArray.length-1)?.get("input")?.value||"").trim()&&this.addWord();let n=this.wordEntries();for(;n.length<this.wordsArray.length;)n.push({input:"",error:null});n.length>this.wordsArray.length&&n.splice(this.wordsArray.length),this.wordEntries.set(n)}get wordsArray(){return this.form.get("words")}createWordControl(){return this.fb.group({input:[""]})}addWord(){this.wordsArray.push(this.createWordControl());let e=[...this.wordEntries()];e.push({input:"",error:null}),this.wordEntries.set(e)}removeWord(e){if(this.wordsArray.length>1){this.wordsArray.removeAt(e);let t=[...this.wordEntries()];t.splice(e,1),this.wordEntries.set(t),this.wordsArray.updateValueAndValidity()}}validateWord(e){let r=this.wordsArray.at(e).get("input")?.value||"",o=r.trim(),n=[...this.wordEntries()];for(;n.length<this.wordsArray.length;)n.push({input:"",error:null});if(!o)n[e]={input:r,error:null};else if(this.wordsArray.controls.findIndex((i,m)=>{if(m===e)return!1;let S=i.get("input")?.value||"";return S.trim()?S.trim().toLowerCase()===o.toLowerCase():!1})!==-1)n[e]={input:r,error:"Duplicate word"};else if(n[e]={input:r,error:null},e===this.wordsArray.length-1)for(this.addWord();n.length<this.wordsArray.length;)n.push({input:"",error:null});this.wordEntries.set(n),this.wordsArray.updateValueAndValidity()}onWordBlur(e){this.validateWord(e)}clearError(e){let t=[...this.wordEntries()];t[e]&&(t[e]=A(E({},t[e]),{error:null}),this.wordEntries.set(t))}onWordInputKeydown(e,t){if(e.key==="Enter"){e.preventDefault();let r=t+1;r<this.wordsArray.length?this.focusInput(r):(this.addWord(),setTimeout(()=>this.focusInput(r),0))}else e.key==="Tab"&&!e.shiftKey&&t===this.wordsArray.length-1&&(this.wordsArray.at(t).get("input")?.value||"").trim()&&(e.preventDefault(),this.addWord(),setTimeout(()=>this.focusInput(t+1),0))}focusInput(e){setTimeout(()=>{let t=this.wordInputs.toArray();t[e]&&t[e].nativeElement.focus()},0)}updateWordEntries(){let e=[];this.wordsArray.controls.forEach((t,r)=>{let o=t.get("input")?.value||"";e.push({input:o,error:null})}),this.wordEntries.set(e)}atLeastOneValidWord=e=>{let t=e;if(t.controls.filter(n=>(n.get("input")?.value||"").trim().length>0).length===0)return{atLeastOneValidWord:!0};let o=new Set;for(let n of t.controls){let i=(n.get("input")?.value||"").trim().toLowerCase();if(i){if(o.has(i))return{duplicateWords:!0};o.add(i)}}return null};onSubmit(){if(this.form.invalid){this.form.markAllAsTouched(),this.wordsArray.controls.forEach((i,m)=>{this.validateWord(m)});return}let e=this.form.value,t=e.setName.trim(),r=[],o=new Set;if(e.words.forEach(i=>{let m=i.input.trim();m&&!o.has(m.toLowerCase())&&(r.push(m),o.add(m.toLowerCase()))}),r.length===0)return;let n=new Date,u=r.map((i,m)=>({id:`word-${t.toLowerCase().replace(/\s+/g,"-")}-${m}`,word:i}));if(this.isEditMode()&&this.editingSetId)this.sightWordStateService.updateSet(this.editingSetId,{name:t,cards:u,updatedAt:n});else{let i={id:`set-${t.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}`,name:t,cards:u,createdAt:n,updatedAt:n};this.sightWordStateService.addSet(i)}this.router.navigate(["/afrikaans/sigwoorde"])}goBack(){this.router.navigate(["/afrikaans/sigwoorde"])}static \u0275fac=function(t){return new(t||d)};static \u0275cmp=k({type:d,selectors:[["app-afrikaans-set-creator"]],viewQuery:function(t,r){if(t&1&&N(Y,5),t&2){let o;P(o=V())&&(r.wordInputs=o)}},decls:26,vars:6,consts:[["wordInput",""],[1,"set-creator"],[1,"header"],["type","button","aria-label","Go back",1,"back-button",3,"click"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","setName",1,"label"],["id","setName","type","text","formControlName","setName","placeholder","e.g., Basic Words","aria-required","true","aria-describedby","setNameError",1,"input"],["id","setNameError",1,"error"],[1,"label"],[1,"hint"],["formArrayName","words",1,"words-list"],[1,"word-entry",3,"formGroupName"],[1,"error"],[1,"form-actions"],["type","button",1,"cancel-button",3,"click"],["type","submit",1,"submit-button",3,"disabled"],["type","text","formControlName","input",1,"word-input",3,"blur","input","keydown","placeholder"],["type","button","aria-label","Remove word",1,"remove-button"],["type","button","aria-label","Remove word",1,"remove-button",3,"click"]],template:function(t,r){if(t&1&&(s(0,"div",1)(1,"header",2)(2,"button",3),f("click",function(){return r.goBack()}),c(3," \u2190 Back "),a(),s(4,"h1"),c(5),a()(),s(6,"form",4),f("ngSubmit",function(){return r.onSubmit()}),s(7,"div",5)(8,"label",6),c(9,"Set Name"),a(),O(10,"input",7),w(11,Z,2,0,"span",8),a(),s(12,"div",5)(13,"label",9),c(14,"Sight Words"),a(),s(15,"p",10),c(16,"Enter Afrikaans sight words, one per line"),a(),s(17,"div",11),I(18,rt,5,5,"div",12,W),a(),w(20,nt,2,0,"span",13),a(),s(21,"div",14)(22,"button",15),f("click",function(){return r.goBack()}),c(23," Cancel "),a(),s(24,"button",16),c(25),a()()()()),t&2){let o,n;l(5),x(r.isEditMode()?"Edit Sight Word Set":"Create Sight Word Set"),l(),v("formGroup",r.form),l(5),b((o=r.form.get("setName"))!=null&&o.invalid&&((o=r.form.get("setName"))!=null&&o.touched)?11:-1),l(7),F(r.wordsArray.controls),l(2),b((n=r.form.get("words"))!=null&&n.invalid&&((n=r.form.get("words"))!=null&&n.touched)?20:-1),l(4),v("disabled",r.form.invalid),l(),T(" ",r.isEditMode()?"Save Changes":"Create Set"," ")}},dependencies:[J,R,L,B,z,j,K,Q,q],styles:[".set-creator[_ngcontent-%COMP%]{min-height:100vh;min-height:100dvh;padding:1rem;background:var(--bg-primary, #fff);color:var(--text-primary, #333);max-width:600px;margin:0 auto}.header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-button[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--app-afrikaans-accent, #FF9800);font-size:1rem;cursor:pointer;padding:.5rem 0;margin-bottom:1rem;min-height:44px}.back-button[_ngcontent-%COMP%]:hover{text-decoration:underline}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(1.75rem,4vw,2.5rem);margin:0;color:var(--text-primary, #333)}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.label[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, #333)}.hint[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #666);margin:0}.input[_ngcontent-%COMP%], .word-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;font-size:1rem;border:2px solid var(--input-border, #ccc);border-radius:.5rem;background:var(--input-bg, #fff);color:var(--text-primary, #333);min-height:44px}.input[_ngcontent-%COMP%]:focus, .word-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--app-afrikaans-accent, #FF9800)}.words-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}.word-entry[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;position:relative}.error[_ngcontent-%COMP%]{font-size:.875rem;color:var(--error-color, #f44336)}.remove-button[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:.5rem;width:32px;height:32px;border:none;background:var(--error-color, #f44336);color:#fff;border-radius:50%;cursor:pointer;font-size:1.25rem;display:flex;align-items:center;justify-content:center;line-height:1}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:2rem}.cancel-button[_ngcontent-%COMP%], .submit-button[_ngcontent-%COMP%]{flex:1;padding:.75rem 1.5rem;font-size:1rem;font-weight:600;border-radius:.5rem;cursor:pointer;min-height:44px;border:2px solid;transition:all .2s ease}.cancel-button[_ngcontent-%COMP%]{background:transparent;color:var(--text-primary, #333);border-color:var(--button-secondary-border, #ccc)}.cancel-button[_ngcontent-%COMP%]:hover{background:var(--button-secondary-bg, #f0f0f0)}.submit-button[_ngcontent-%COMP%]{background:var(--app-afrikaans-accent, #FF9800);color:var(--button-primary-text, #fff);border-color:var(--app-afrikaans-accent, #FF9800)}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--app-afrikaans-accent-hover, #F57C00)}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media(prefers-color-scheme:dark){.set-creator[_ngcontent-%COMP%]{--bg-primary: #1a1a1a;--text-primary: #fff;--text-secondary: #aaa;--input-bg: #2a2a2a;--input-border: #444;--button-secondary-bg: #333;--button-secondary-border: #555;--button-secondary-hover: #444;--error-color: #f44336;--button-primary-text: #fff}}"],changeDetection:0})};export{X as SetCreatorComponent};
