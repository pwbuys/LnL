import{a as g}from"./chunk-NHPTLCVL.js";import{b as S}from"./chunk-WDXSJPWS.js";import{g as u,j as l,o as n,p as h}from"./chunk-FYXY47SE.js";import{a as i,b as o}from"./chunk-2NFLSA4Y.js";var m="school-helper-math-sets",v=class c{userProgressService=l(g);defaultWeight=1;availableSets=n([]);currentSet=n(null);currentSessionStats=n(null);currentMode=n("master");currentTimedDuration=n(null);currentLevel=n("level1");getSpeedThresholdMs(){return S(this.currentLevel()).speedThresholdMs}constructor(){let e=this.loadFromLocalStorage(),t=this.createMockSets(),r=e.length>0?this.mergeSets(e,t):t;this.availableSets.set(r),h(()=>{let s=this.availableSets();this.saveToLocalStorage(s)})}loadFromLocalStorage(){try{let e=localStorage.getItem(m);return e?JSON.parse(e).map(r=>o(i({},r),{cards:r.cards,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)})):[]}catch(e){return console.error("Error loading math sets from localStorage:",e),[]}}saveToLocalStorage(e){try{let t=e.map(r=>({id:r.id,name:r.name,cards:r.cards.map(s=>({id:s.id,question:s.question,answer:s.answer})),createdAt:r.createdAt.toISOString(),updatedAt:r.updatedAt.toISOString()}));localStorage.setItem(m,JSON.stringify(t))}catch(t){console.error("Error saving math sets to localStorage:",t)}}mergeSets(e,t){let r=new Set(e.map(a=>a.id)),s=t.filter(a=>!r.has(a.id));return[...e,...s]}createMockSets(){let e=new Date,t=[this.createCard("3x1","3 x 1",3),this.createCard("3x2","3 x 2",6),this.createCard("3x3","3 x 3",9),this.createCard("3x4","3 x 4",12),this.createCard("3x5","3 x 5",15),this.createCard("3x6","3 x 6",18),this.createCard("3x7","3 x 7",21),this.createCard("3x8","3 x 8",24),this.createCard("3x9","3 x 9",27),this.createCard("3x10","3 x 10",30)],r=[this.createCard("4x1","4 x 1",4),this.createCard("4x2","4 x 2",8),this.createCard("4x3","4 x 3",12),this.createCard("4x4","4 x 4",16),this.createCard("4x5","4 x 5",20),this.createCard("4x6","4 x 6",24),this.createCard("4x7","4 x 7",28),this.createCard("4x8","4 x 8",32),this.createCard("4x9","4 x 9",36),this.createCard("4x10","4 x 10",40)],s=[this.createCard("8x1","8 x 1",8),this.createCard("8x2","8 x 2",16),this.createCard("8x3","8 x 3",24),this.createCard("8x4","8 x 4",32),this.createCard("8x5","8 x 5",40),this.createCard("8x6","8 x 6",48),this.createCard("8x7","8 x 7",56),this.createCard("8x8","8 x 8",64),this.createCard("8x9","8 x 9",72),this.createCard("8x10","8 x 10",80)];return[{id:"mult-3s",name:"Multiplication 3s",cards:t,createdAt:e,updatedAt:e},{id:"mult-4s",name:"Multiplication 4s",cards:r,createdAt:e,updatedAt:e},{id:"mult-8s",name:"Multiplication 8s",cards:s,createdAt:e,updatedAt:e}]}createCard(e,t,r){return{id:e,question:t,answer:r}}mergeCardWithProgress(e){this.userProgressService.progressUpdateTrigger();let t=this.userProgressService.getCardProgress(e.id);return t?o(i({},e),{weight:t.weight,consecutiveCorrect:t.consecutiveCorrect,lastDurationMs:t.lastDurationMs,stats:t.stats}):o(i({},e),{weight:this.defaultWeight,consecutiveCorrect:0,stats:{totalAttempts:0,correctAttempts:0,fastAttempts:0,slowAttempts:0,incorrectAttempts:0}})}getCardsWithProgress(e){return e.cards.map(t=>this.mergeCardWithProgress(t))}setCurrentSet(e){let t=this.availableSets().find(r=>r.id===e);t&&this.currentSet.set(t)}clearCurrentSet(){this.currentSet.set(null)}setExerciseOptions(e,t,r){this.currentMode.set(e),this.currentLevel.set(t),this.currentTimedDuration.set(r??null)}startSession(){if(!this.currentSet())return;let t={startTime:new Date,totalQuestions:0,correctAnswers:0,fastAnswers:0,slowAnswers:0,incorrectAnswers:0,averageTimeMs:0,mode:this.currentMode(),timedDuration:this.currentTimedDuration()??void 0,level:this.currentLevel()};this.currentSessionStats.set(t)}endSession(){let e=this.currentSessionStats();e&&this.currentSessionStats.set(o(i({},e),{endTime:new Date}))}getCardById(e){let t=this.currentSet();if(!t)return;let r=t.cards.find(s=>s.id===e);if(r)return this.mergeCardWithProgress(r)}updateCard(e,t){this.userProgressService.updateCardProgress(e,{weight:t.weight,consecutiveCorrect:t.consecutiveCorrect,lastDurationMs:t.lastDurationMs,stats:t.stats})}addSet(e){let t=this.availableSets();this.availableSets.set([...t,e])}updateSet(e,t){let s=this.availableSets().map(d=>d.id===e?o(i(i({},d),t),{updatedAt:new Date}):d);this.availableSets.set(s);let a=this.currentSet();if(a&&a.id===e){let d=s.find(x=>x.id===e);d&&this.currentSet.set(d)}}getSetById(e){return this.availableSets().find(t=>t.id===e)}deleteSet(e){let r=this.availableSets().filter(a=>a.id!==e);this.availableSets.set(r);let s=this.currentSet();s&&s.id===e&&this.currentSet.set(null)}resetSetProgress(e){let t=this.getSetById(e);if(!t)return;let r=t.cards.map(s=>s.id);this.userProgressService.resetSetProgressAndMastery(e,r)}static \u0275fac=function(t){return new(t||c)};static \u0275prov=u({token:c,factory:c.\u0275fac,providedIn:"root"})};export{v as a};
