import{b as L}from"./chunk-MNR4JMD7.js";import{a as R,b as Q,c as H,d as K,e as j,g as U,h as J,i as W,j as X,m as Y,n as Z}from"./chunk-6Z5YC7IV.js";import"./chunk-4USDWUO2.js";import{$ as D,D as k,E as b,F as f,G as N,H as V,I as O,J as C,K as l,L as s,M as $,Q as S,R as h,T as p,U as q,V as F,W as T,Z as u,_ as P,aa as G,ha as B,j as _,ja as z,k as y,l as v,o as E,v as m,y as I}from"./chunk-BRS2FBVW.js";import{a as w,b as M}from"./chunk-2NFLSA4Y.js";function x(a){if(!a||typeof a!="string")return null;let e=a.trim().match(/^(\d+)\s*[x*]\s*(\d+)$/i);if(!e)return null;let r=parseInt(e[1],10),o=parseInt(e[2],10);if(isNaN(r)||isNaN(o))return null;let n=r*o;return{question:`${r} x ${o}`,answer:n}}var te=["problemInput"];function re(a,t){a&1&&(l(0,"span",8),u(1,"Set name is required"),s())}function ne(a,t){if(a&1&&(l(0,"span",13),u(1),s()),a&2){let e=p().$index,r=p();m(),P(r.problemEntries()[e].error)}}function oe(a,t){if(a&1&&(l(0,"span",18),u(1),s()),a&2){let e=p().$index,r=p();m(),G(" ",r.problemEntries()[e].parsed.question," = ",r.problemEntries()[e].parsed.answer," ")}}function ie(a,t){if(a&1){let e=S();l(0,"button",20),h("click",function(){y(e);let o=p().$index,n=p();return v(n.removeProblem(o))}),u(1," \u2715 "),s()}}function ae(a,t){if(a&1){let e=S();l(0,"div",12)(1,"input",17,0),h("blur",function(){let o=y(e).$index,n=p();return v(n.onProblemBlur(o))})("input",function(){let o=y(e).$index,n=p();return v(n.clearError(o))})("keydown",function(o){let n=y(e).$index,i=p();return v(i.onProblemInputKeydown(o,n))}),s(),b(3,ne,2,1,"span",13),b(4,oe,2,2,"span",18),b(5,ie,2,0,"button",19),s()}if(a&2){let e,r,o=t.$index,n=t.$index,i=p();C("formGroupName",n),m(),C("placeholder","e.g., "+(o===0?"3x5":"4x6")),k("data-problem-index",n),m(2),f((e=i.problemEntries()[n])!=null&&e.error?3:-1),m(),f((r=i.problemEntries()[n])!=null&&r.parsed?4:-1),m(),f(i.problemsArray.length>1?5:-1)}}function se(a,t){a&1&&(l(0,"span",13),u(1,"At least one valid problem is required"),s())}var ee=class a{fb=_(Y);mathStateService=_(L);router=_(z);route=_(B);form;problemEntries=E([]);isEditMode=E(!1);editingSetId=null;problemInputs;constructor(){this.form=this.fb.group({setName:["",[Q.required]],problems:this.fb.array([this.createProblemControl()],[this.atLeastOneValidProblem])}),this.route.params.subscribe(t=>{let e=t.setId;e?(this.isEditMode.set(!0),this.editingSetId=e,this.loadSetForEditing(e)):(this.isEditMode.set(!1),this.editingSetId=null,this.updateProblemEntries())})}loadSetForEditing(t){let e=this.mathStateService.getSetById(t);if(!e){this.router.navigate(["/math"]);return}for(this.form.patchValue({setName:e.name});this.problemsArray.length>0;)this.problemsArray.removeAt(0);e.cards.forEach(i=>{let c=this.createProblemControl();c.patchValue({input:i.question}),this.problemsArray.push(c)}),this.problemsArray.controls.forEach((i,c)=>{this.validateProblem(c)}),(this.problemsArray.at(this.problemsArray.length-1)?.get("input")?.value||"").trim()&&this.addProblem();let n=this.problemEntries();for(;n.length<this.problemsArray.length;)n.push({input:"",parsed:null,error:null});n.length>this.problemsArray.length&&n.splice(this.problemsArray.length),this.problemEntries.set(n)}get problemsArray(){return this.form.get("problems")}createProblemControl(){return this.fb.group({input:[""]})}addProblem(){this.problemsArray.push(this.createProblemControl());let t=[...this.problemEntries()];t.push({input:"",parsed:null,error:null}),this.problemEntries.set(t)}removeProblem(t){if(this.problemsArray.length>1){this.problemsArray.removeAt(t);let e=[...this.problemEntries()];e.splice(t,1),this.problemEntries.set(e)}}validateProblem(t){let r=this.problemsArray.at(t).get("input")?.value||"",o=r.trim(),n=[...this.problemEntries()];for(;n.length<this.problemsArray.length;)n.push({input:"",parsed:null,error:null});if(!o)n[t]={input:r,parsed:null,error:null};else{let i=x(o);if(!i)n[t]={input:r,parsed:null,error:"Invalid format. Use: 3x5, 4 x 6, or 8*7"};else if(this.problemsArray.controls.findIndex((d,g)=>{if(g===t)return!1;let A=d.get("input")?.value||"";return A.trim()?x(A.trim())?.question===i.question:!1})!==-1)n[t]={input:r,parsed:null,error:"Duplicate problem"};else if(n[t]={input:r,parsed:i,error:null},t===this.problemsArray.length-1)for(this.addProblem();n.length<this.problemsArray.length;)n.push({input:"",parsed:null,error:null})}this.problemEntries.set(n),this.problemsArray.markAsTouched(),this.problemsArray.updateValueAndValidity(),this.form.updateValueAndValidity()}onProblemBlur(t){(this.problemsArray.at(t).get("input")?.value||"").trim()?this.validateProblem(t):this.clearError(t)}clearError(t){let e=[...this.problemEntries()];for(;e.length<this.problemsArray.length;)e.push({input:"",parsed:null,error:null});e[t]?e[t]=M(w({},e[t]),{error:null}):e[t]={input:"",parsed:null,error:null},this.problemEntries.set(e),this.problemsArray.updateValueAndValidity(),this.form.updateValueAndValidity()}updateProblemEntries(){let t=this.problemEntries(),e=this.problemsArray.controls.map((r,o)=>{let n=r.get("input")?.value||"",i=t[o];return i&&i.input===n?i:{input:n,parsed:null,error:null}});this.problemEntries.set(e)}atLeastOneValidProblem=t=>{let e=t;return e.length===0?{noProblems:!0}:e.controls.some(o=>{let i=(o.get("input")?.value||"").trim();return i?x(i)!==null:!1})?null:{noValidProblems:!0}};onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}let t=this.form.get("setName")?.value,e=this.problemsArray.controls.map(o=>{let n=o.get("input")?.value||"";return x(n)}).filter(o=>o!==null),r=Array.from(new Map(e.map(o=>[o.question,o])).values());if(this.isEditMode()&&this.editingSetId){let o=this.mathStateService.getSetById(this.editingSetId);if(!o){this.router.navigate(["/math"]);return}let n=r.map((i,c)=>{let d=o.cards.find(g=>g.question===i.question);return d?{id:d.id,question:i.question,answer:i.answer}:{id:`${t.toLowerCase().replace(/\s+/g,"-")}-${Date.now()}-${c}`,question:i.question,answer:i.answer}});this.mathStateService.updateSet(this.editingSetId,{name:t,cards:n})}else{let o=r.map((d,g)=>({id:`${t.toLowerCase().replace(/\s+/g,"-")}-${g}`,question:d.question,answer:d.answer})),n=new Date,c={id:`set-${Date.now()}`,name:t,cards:o,createdAt:n,updatedAt:n};this.mathStateService.addSet(c)}this.router.navigate(["/math"])}ngAfterViewInit(){this.problemsArray.length===0&&this.addProblem()}onProblemInputKeydown(t,e){if(t.key==="Tab"||t.key==="Enter"){t.preventDefault(),t.key==="Enter"&&(this.problemsArray.at(e).get("input")?.value||"").trim()&&this.validateProblem(e);let r=e+1;r<this.problemsArray.length?setTimeout(()=>this.focusInput(r),10):(this.addProblem(),setTimeout(()=>this.focusInput(r),50))}}focusInput(t){let e=this.problemInputs.toArray();if(e[t])e[t].nativeElement.focus();else{let r=document.querySelector(`[data-problem-index="${t}"]`);r&&r.focus()}}goBack(){this.router.navigate(["/math"])}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=I({type:a,selectors:[["app-set-creator"]],viewQuery:function(e,r){if(e&1&&q(te,5),e&2){let o;F(o=T())&&(r.problemInputs=o)}},decls:26,vars:6,consts:[["problemInput",""],[1,"set-creator"],[1,"header"],["type","button","aria-label","Go back",1,"back-button",3,"click"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","setName",1,"label"],["id","setName","type","text","formControlName","setName","placeholder","e.g., Hard 8s","aria-required","true","aria-describedby","setNameError",1,"input"],["id","setNameError",1,"error"],[1,"label"],[1,"hint"],["formArrayName","problems",1,"problems-list"],[1,"problem-entry",3,"formGroupName"],[1,"error"],[1,"form-actions"],["type","button",1,"cancel-button",3,"click"],["type","submit",1,"submit-button",3,"disabled"],["type","text","formControlName","input",1,"problem-input",3,"blur","input","keydown","placeholder"],[1,"parsed-info"],["type","button","aria-label","Remove problem",1,"remove-button"],["type","button","aria-label","Remove problem",1,"remove-button",3,"click"]],template:function(e,r){if(e&1&&(l(0,"div",1)(1,"header",2)(2,"button",3),h("click",function(){return r.goBack()}),u(3," \u2190 Back "),s(),l(4,"h1"),u(5),s()(),l(6,"form",4),h("ngSubmit",function(){return r.onSubmit()}),l(7,"div",5)(8,"label",6),u(9,"Set Name"),s(),$(10,"input",7),b(11,re,2,0,"span",8),s(),l(12,"div",5)(13,"label",9),u(14,"Math Problems"),s(),l(15,"p",10),u(16,"Enter problems like: 3x5, 4 x 6, 8*7"),s(),l(17,"div",11),V(18,ae,6,6,"div",12,N),s(),b(20,se,2,0,"span",13),s(),l(21,"div",14)(22,"button",15),h("click",function(){return r.goBack()}),u(23," Cancel "),s(),l(24,"button",16),u(25),s()()()()),e&2){let o,n;m(5),P(r.isEditMode()?"Edit Math Set":"Create Math Set"),m(),C("formGroup",r.form),m(5),f((o=r.form.get("setName"))!=null&&o.invalid&&((o=r.form.get("setName"))!=null&&o.touched)?11:-1),m(7),O(r.problemsArray.controls),m(2),f((n=r.form.get("problems"))!=null&&n.invalid&&((n=r.form.get("problems"))!=null&&n.touched)?20:-1),m(4),C("disabled",r.form.invalid),m(),D(" ",r.isEditMode()?"Save Changes":"Create Set"," ")}},dependencies:[Z,j,R,H,K,X,W,U,J],styles:[".set-creator[_ngcontent-%COMP%]{min-height:100vh;padding:1rem;background:var(--bg-primary, #fff);color:var(--text-primary, #333);max-width:600px;margin:0 auto}.header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-button[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--link-color, #4caf50);font-size:1rem;cursor:pointer;padding:.5rem 0;margin-bottom:1rem;min-height:44px}.back-button[_ngcontent-%COMP%]:hover{text-decoration:underline}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(1.75rem,4vw,2.5rem);margin:0;color:var(--text-primary, #333)}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.label[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--text-primary, #333)}.hint[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary, #666);margin:0}.input[_ngcontent-%COMP%], .problem-input[_ngcontent-%COMP%]{width:100%;padding:.75rem;font-size:1rem;border:2px solid var(--input-border, #ccc);border-radius:.5rem;background:var(--input-bg, #fff);color:var(--text-primary, #333);min-height:44px}.input[_ngcontent-%COMP%]:focus, .problem-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--input-focus-border, #4caf50)}.problems-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}.problem-entry[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;position:relative}.parsed-info[_ngcontent-%COMP%]{font-size:.875rem;color:var(--success-color, #4caf50);font-weight:600}.error[_ngcontent-%COMP%]{font-size:.875rem;color:var(--error-color, #f44336)}.remove-button[_ngcontent-%COMP%]{position:absolute;right:.5rem;top:.5rem;width:32px;height:32px;border:none;background:var(--error-color, #f44336);color:#fff;border-radius:50%;cursor:pointer;font-size:1.25rem;display:flex;align-items:center;justify-content:center;line-height:1}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:2rem}.cancel-button[_ngcontent-%COMP%], .submit-button[_ngcontent-%COMP%]{flex:1;padding:.75rem 1.5rem;font-size:1rem;font-weight:600;border-radius:.5rem;cursor:pointer;min-height:44px;border:2px solid;transition:all .2s ease}.cancel-button[_ngcontent-%COMP%]{background:transparent;color:var(--text-primary, #333);border-color:var(--button-secondary-border, #ccc)}.cancel-button[_ngcontent-%COMP%]:hover{background:var(--button-secondary-bg, #f0f0f0)}.submit-button[_ngcontent-%COMP%]{background:var(--button-primary-bg, #4caf50);color:var(--button-primary-text, #fff);border-color:var(--button-primary-border, #45a049)}.submit-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--button-primary-hover, #45a049)}.submit-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media(prefers-color-scheme:dark){.set-creator[_ngcontent-%COMP%]{--bg-primary: #1a1a1a;--text-primary: #fff;--text-secondary: #aaa;--input-bg: #2a2a2a;--input-border: #444;--input-focus-border: #4caf50;--button-secondary-bg: #333;--button-secondary-border: #555;--button-secondary-hover: #444;--link-color: #4caf50;--success-color: #4caf50;--error-color: #f44336;--button-primary-bg: #4caf50;--button-primary-hover: #45a049;--button-primary-border: #45a049;--button-primary-text: #fff}}"],changeDetection:0})};export{ee as SetCreatorComponent};
