import{a as h}from"./chunk-PDHAO4X2.js";import{b as S}from"./chunk-WDXSJPWS.js";import{g,j as l,o as a,p as u}from"./chunk-FYXY47SE.js";import{a as o,b as n}from"./chunk-2NFLSA4Y.js";var v="school-helper-sight-word-sets",m=class c{sightWordProgressService=l(h);defaultWeight=1;availableSets=a([]);currentSet=a(null);currentSessionStats=a(null);currentMode=a("master");currentTimedDuration=a(null);currentLevel=a("level1");getSpeedThresholdMs(){return S(this.currentLevel()).speedThresholdMs}constructor(){let e=this.loadFromLocalStorage(),t=this.createMockSets(),r=e.length>0?this.mergeSets(e,t):t;this.availableSets.set(r),u(()=>{let s=this.availableSets();this.saveToLocalStorage(s)})}loadFromLocalStorage(){try{let e=localStorage.getItem(v);return e?JSON.parse(e).map(r=>n(o({},r),{cards:r.cards,createdAt:new Date(r.createdAt),updatedAt:new Date(r.updatedAt)})):[]}catch(e){return console.error("Error loading sight word sets from localStorage:",e),[]}}saveToLocalStorage(e){try{let t=e.map(r=>({id:r.id,name:r.name,cards:r.cards.map(s=>({id:s.id,word:s.word})),createdAt:r.createdAt.toISOString(),updatedAt:r.updatedAt.toISOString()}));localStorage.setItem(v,JSON.stringify(t))}catch(t){console.error("Error saving sight word sets to localStorage:",t)}}mergeSets(e,t){let r=new Set(e.map(i=>i.id)),s=t.filter(i=>!r.has(i.id));return[...e,...s]}createMockSets(){let e=new Date;return[{id:"basic-words",name:"Basic Words",cards:[this.createCard("word-die","die"),this.createCard("word-en","en"),this.createCard("word-van","van"),this.createCard("word-is","is"),this.createCard("word-ek","ek"),this.createCard("word-hy","hy"),this.createCard("word-sy","sy"),this.createCard("word-ons","ons"),this.createCard("word-julle","julle"),this.createCard("word-hulle","hulle")],createdAt:e,updatedAt:e}]}createCard(e,t){return{id:e,word:t}}mergeCardWithProgress(e){this.sightWordProgressService.progressUpdateTrigger();let t=this.sightWordProgressService.getWordProgress(e.id);return t?n(o({},e),{weight:t.weight,consecutiveCorrect:t.consecutiveCorrect,lastDurationMs:t.lastDurationMs,stats:t.stats}):n(o({},e),{weight:this.defaultWeight,consecutiveCorrect:0,stats:{totalAttempts:0,correctAttempts:0,fastAttempts:0,slowAttempts:0,incorrectAttempts:0}})}getCardsWithProgress(e){return e.cards.map(t=>this.mergeCardWithProgress(t))}setCurrentSet(e){let t=this.availableSets().find(r=>r.id===e);t&&this.currentSet.set(t)}clearCurrentSet(){this.currentSet.set(null)}setExerciseOptions(e,t,r){this.currentMode.set(e),this.currentLevel.set(t),this.currentTimedDuration.set(r??null)}startSession(){if(!this.currentSet())return;let t={startTime:new Date,totalQuestions:0,correctAnswers:0,fastAnswers:0,slowAnswers:0,incorrectAnswers:0,averageTimeMs:0,mode:this.currentMode(),timedDuration:this.currentTimedDuration()??void 0,level:this.currentLevel()};this.currentSessionStats.set(t)}endSession(){let e=this.currentSessionStats();e&&this.currentSessionStats.set(n(o({},e),{endTime:new Date}))}getCardById(e){let t=this.currentSet();if(!t)return;let r=t.cards.find(s=>s.id===e);if(r)return this.mergeCardWithProgress(r)}updateCard(e,t){this.sightWordProgressService.updateWordProgress(e,{weight:t.weight,consecutiveCorrect:t.consecutiveCorrect,lastDurationMs:t.lastDurationMs,stats:t.stats})}addSet(e){let t=this.availableSets();this.availableSets.set([...t,e])}updateSet(e,t){let s=this.availableSets().map(d=>d.id===e?n(o(o({},d),t),{updatedAt:new Date}):d);this.availableSets.set(s);let i=this.currentSet();if(i&&i.id===e){let d=s.find(p=>p.id===e);d&&this.currentSet.set(d)}}getSetById(e){return this.availableSets().find(t=>t.id===e)}deleteSet(e){let r=this.availableSets().filter(i=>i.id!==e);this.availableSets.set(r);let s=this.currentSet();s&&s.id===e&&this.currentSet.set(null)}resetSetProgress(e){let t=this.getSetById(e);if(!t)return;let r=t.cards.map(s=>s.id);this.sightWordProgressService.resetSetProgressAndMastery(e,r)}static \u0275fac=function(t){return new(t||c)};static \u0275prov=g({token:c,factory:c.\u0275fac,providedIn:"root"})};export{m as a};
