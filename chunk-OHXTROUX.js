import{a as N}from"./chunk-PDHAO4X2.js";import{a as I,b as M,c as V,d as z,e as $,h as G,i as K,j as A,k as L}from"./chunk-WHULS3JR.js";import{a as F}from"./chunk-NHPTLCVL.js";import{c as S}from"./chunk-WDXSJPWS.js";import{$ as U,D as C,E as u,F as p,I as k,J as O,K as x,L as s,M as n,N as E,R as b,S as m,U as c,Z as y,_ as l,g as P,j as d,k as h,l as f,o as _,p as T,v as i,y as D}from"./chunk-FYXY47SE.js";var J="school-helper-user-",X="-settings",v=3e3,R=1e3,j=1e4,w=class o{userService=d(S);speedThresholdMs=_(v);constructor(){T(()=>{let e=this.userService.currentUser();e&&this.loadFromLocalStorage(e)})}loadFromLocalStorage(e){try{let t=this.getStorageKey(e),r=localStorage.getItem(t);if(r){let a=JSON.parse(r),g=this.validateSpeedThreshold(a.speedThresholdMs);this.speedThresholdMs.set(g)}else this.speedThresholdMs.set(v)}catch(t){console.error(`Error loading math settings for user ${e}:`,t),this.speedThresholdMs.set(v)}}saveSettings(e){let t=this.userService.getCurrentUserName();if(t)try{let r={speedThresholdMs:this.validateSpeedThreshold(e.speedThresholdMs)},a=this.getStorageKey(t);localStorage.setItem(a,JSON.stringify(r)),this.speedThresholdMs.set(r.speedThresholdMs)}catch(r){console.error("Error saving math settings to localStorage:",r)}}getStorageKey(e){return`${J}${e}${X}`}initializeUserSettings(e){let t={speedThresholdMs:v},r=this.getStorageKey(e);localStorage.setItem(r,JSON.stringify(t))}deleteUserSettings(e){try{let t=this.getStorageKey(e);localStorage.removeItem(t)}catch(t){console.error(`Error deleting settings for user ${e}:`,t)}}validateSpeedThreshold(e){return typeof e!="number"||isNaN(e)?v:Math.max(R,Math.min(j,e))}getSettings(){return{speedThresholdMs:this.speedThresholdMs()}}getMinSpeedThreshold(){return R}getMaxSpeedThreshold(){return j}static \u0275fac=function(t){return new(t||o)};static \u0275prov=P({token:o,factory:o.\u0275fac,providedIn:"root"})};var B=(o,e)=>e.name;function Y(o,e){o&1&&(s(0,"span",15),l(1,"\u2713"),n())}function Q(o,e){if(o&1){let t=b();s(0,"button",17),m("click",function(a){h(t);let g=c().$implicit,W=c(2);return f(W.deleteUser(g.name,a))}),l(1," \u2715 "),n()}if(o&2){let t=c().$implicit;C("aria-label","Delete user "+t.name)}}function Z(o,e){if(o&1){let t=b();s(0,"div",7)(1,"button",13),m("click",function(){let a=h(t).$implicit,g=c(2);return f(g.switchUser(a.name))}),s(2,"span",14),l(3),n(),u(4,Y,2,0,"span",15),n(),u(5,Q,2,1,"button",16),n()}if(o&2){let t=e.$implicit,r=c(2);i(),y("active",t.name===r.currentUser()),i(2),U(t.name),i(),p(t.name===r.currentUser()?4:-1),i(),p(r.canDeleteUser(t.name)?5:-1)}}function ee(o,e){o&1&&l(0," User name is required ")}function te(o,e){if(o&1&&(s(0,"div",12),u(1,ee,1,0),n()),o&2){let t,r=c(2);i(),p(!((t=r.newUserForm.get("userName"))==null||t.errors==null)&&t.errors.required?1:-1)}}function re(o,e){if(o&1){let t=b();s(0,"div",5)(1,"div",6),l(2,"Users"),n(),k(3,Z,6,5,"div",7,B),E(5,"div",8),s(6,"form",9),m("ngSubmit",function(){h(t);let a=c();return f(a.createUser())}),s(7,"input",10),m("keydown.escape",function(){h(t);let a=c();return f(a.closeDropdown())}),n(),s(8,"button",11),l(9," Create "),n()(),u(10,te,2,1,"div",12),n()}if(o&2){let t,r=c();i(3),O(r.users()),i(3),x("formGroup",r.newUserForm),i(2),x("disabled",r.newUserForm.invalid),i(2),p((t=r.newUserForm.get("userName"))!=null&&t.invalid&&((t=r.newUserForm.get("userName"))!=null&&t.touched)?10:-1)}}var H=class o{userService=d(S);userProgressService=d(F);sightWordProgressService=d(N);settingsService=d(w);fb=d(A);users=this.userService.users;currentUser=this.userService.currentUser;showDropdown=_(!1);newUserForm;constructor(){this.newUserForm=this.fb.group({userName:["",[M.required,M.minLength(1)]]})}toggleDropdown(){this.showDropdown.update(e=>!e)}closeDropdown(){this.showDropdown.set(!1),this.newUserForm.reset()}switchUser(e){this.userService.switchUser(e),this.closeDropdown()}createUser(){if(this.newUserForm.invalid){this.newUserForm.markAllAsTouched();return}let e=this.newUserForm.get("userName")?.value?.trim();if(!e)return;this.userService.createUser(e)?(this.userProgressService.initializeUserProgress(e),this.settingsService.initializeUserSettings(e),this.userService.switchUser(e),this.newUserForm.reset(),this.closeDropdown()):this.newUserForm.get("userName")?.setErrors({duplicate:!0})}canDeleteUser(e){return this.users().length>1}deleteUser(e,t){if(t.stopPropagation(),!this.canDeleteUser(e))return;let r=`Are you sure you want to delete user "${e}"? This will permanently delete all their progress and settings. This action cannot be undone.`;confirm(r)&&(this.userProgressService.deleteUserProgress(e),this.userProgressService.deleteUserMastery(e),this.sightWordProgressService.deleteUserProgress(e),this.sightWordProgressService.deleteUserMastery(e),this.settingsService.deleteUserSettings(e),this.userService.deleteUser(e)||alert(`Cannot delete user "${e}". You must have at least one user.`))}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=D({type:o,selectors:[["app-user-selector"]],decls:9,vars:6,consts:[[1,"user-selector"],["type","button",1,"user-button",3,"click"],[1,"user-icon"],[1,"user-name"],[1,"dropdown-arrow"],["role","menu",1,"dropdown-menu"],[1,"dropdown-header"],[1,"user-option-wrapper"],[1,"divider"],[1,"new-user-form",3,"ngSubmit","formGroup"],["type","text","formControlName","userName","placeholder","New user name","aria-label","New user name",1,"new-user-input",3,"keydown.escape"],["type","submit","aria-label","Create new user",1,"create-button",3,"disabled"],[1,"error-message"],["type","button","role","menuitem",1,"user-option",3,"click"],[1,"user-option-name"],[1,"checkmark"],["type","button","title","Delete user",1,"delete-user-button"],["type","button","title","Delete user",1,"delete-user-button",3,"click"]],template:function(t,r){t&1&&(s(0,"div",0)(1,"button",1),m("click",function(){return r.toggleDropdown()}),s(2,"span",2),l(3,"\u{1F464}"),n(),s(4,"span",3),l(5),n(),s(6,"span",4),l(7,"\u25BC"),n()(),u(8,re,11,3,"div",5),n()),t&2&&(i(),C("aria-expanded",r.showDropdown())("aria-label","Current user: "+r.currentUser()+", click to switch user"),i(4),U(r.currentUser()),i(),y("open",r.showDropdown()),i(2),p(r.showDropdown()?8:-1))},dependencies:[L,$,I,V,z,K,G],styles:[".user-selector[_ngcontent-%COMP%]{position:relative}.user-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--user-button-bg, #f5f5f5);border:2px solid var(--user-button-border, #e0e0e0);border-radius:.5rem;cursor:pointer;font-size:.875rem;font-weight:600;color:var(--text-primary, #333);min-height:44px;transition:all .2s ease}.user-button[_ngcontent-%COMP%]:hover{background:var(--user-button-hover, #e0e0e0);border-color:var(--user-button-hover-border, #ccc)}.user-icon[_ngcontent-%COMP%]{font-size:1.25rem}.user-name[_ngcontent-%COMP%]{flex:1;text-align:left}.dropdown-arrow[_ngcontent-%COMP%]{font-size:.75rem;transition:transform .2s ease}.dropdown-arrow.open[_ngcontent-%COMP%]{transform:rotate(180deg)}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:calc(100% + .5rem);right:0;min-width:200px;background:var(--dropdown-bg, #fff);border:2px solid var(--dropdown-border, #e0e0e0);border-radius:.5rem;box-shadow:0 4px 12px #00000026;z-index:1000;max-height:400px;overflow-y:auto}.dropdown-header[_ngcontent-%COMP%]{padding:.75rem 1rem;font-weight:600;font-size:.875rem;color:var(--text-secondary, #666);border-bottom:1px solid var(--dropdown-border, #e0e0e0)}.user-option-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:0 .5rem}.user-option[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:space-between;padding:.75rem 1rem;background:transparent;border:none;text-align:left;cursor:pointer;font-size:.875rem;color:var(--text-primary, #333);transition:background .2s ease;min-height:44px;border-radius:.25rem}.user-option[_ngcontent-%COMP%]:hover{background:var(--user-option-hover, #f5f5f5)}.user-option.active[_ngcontent-%COMP%]{background:var(--user-option-active, #e3f2fd);color:var(--user-option-active-text, #1976d2)}.user-option-name[_ngcontent-%COMP%]{flex:1}.checkmark[_ngcontent-%COMP%]{color:var(--success-color, #4caf50);font-weight:700}.divider[_ngcontent-%COMP%]{height:1px;background:var(--dropdown-border, #e0e0e0);margin:.5rem 0}.new-user-form[_ngcontent-%COMP%]{padding:.75rem 1rem;display:flex;gap:.5rem}.new-user-input[_ngcontent-%COMP%]{flex:1;padding:.5rem;border:2px solid var(--input-border, #ccc);border-radius:.25rem;font-size:.875rem;min-height:36px}.new-user-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--input-focus-border, #4caf50)}.create-button[_ngcontent-%COMP%]{padding:.5rem 1rem;background:var(--button-primary-bg, #4caf50);color:var(--button-primary-text, #fff);border:none;border-radius:.25rem;font-size:.875rem;font-weight:600;cursor:pointer;min-height:36px;transition:background .2s ease}.create-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--button-primary-hover, #45a049)}.create-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.delete-user-button[_ngcontent-%COMP%]{width:28px;height:28px;border:none;background:var(--delete-bg, #f44336);color:#fff;border-radius:50%;cursor:pointer;font-size:.875rem;display:flex;align-items:center;justify-content:center;line-height:1;transition:all .2s ease;flex-shrink:0}.delete-user-button[_ngcontent-%COMP%]:hover{background:var(--delete-hover, #d32f2f);transform:scale(1.1)}.delete-user-button[_ngcontent-%COMP%]:active{transform:scale(.95)}.error-message[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.75rem;color:var(--error-color, #f44336)}@media(prefers-color-scheme:dark){.user-selector[_ngcontent-%COMP%]{--user-button-bg: #2a2a2a;--user-button-border: #444;--user-button-hover: #333;--user-button-hover-border: #555;--text-primary: #fff;--text-secondary: #aaa;--dropdown-bg: #2a2a2a;--dropdown-border: #444;--user-option-hover: #333;--user-option-active: #1e3a5f;--user-option-active-text: #64b5f6;--input-border: #555;--input-focus-border: #4caf50;--button-primary-bg: #4caf50;--button-primary-hover: #45a049;--button-primary-text: #fff;--success-color: #4caf50;--error-color: #f44336;--delete-bg: #f44336;--delete-hover: #d32f2f}}"],changeDetection:0})};export{H as a};
